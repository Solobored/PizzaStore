@page "/pizzas"
@inject HttpClient Http
@inject Services.OrderState OrderState
@inject NavigationManager NavManager

<h2>Get Pizza</h2>

@if (specials == null)
{
    <p>Loading pizza specials...</p>
}
else
{
    <div class="pizza-grid">
        @foreach (var s in specials)
        {
            <div class="pizza-card">
                <div class="pizza-title">@s.Name</div>
                <div class="pizza-price" style="margin-bottom: 16px;">
                    Price: Â£@s.Price.ToString("0.00")
                </div>
                <button class="btn btn-warning" @onclick="() => AddSpecialToOrder(s)">Add to order</button>
            </div>
        }
    </div>
}

<div style="margin-top: 24px; text-align: center;">
    @if (OrderState.HasItems)
    {
        <button class="btn btn-warning" @onclick='() => NavManager.NavigateTo("/checkout")' style="padding: 12px 24px; font-size: 1rem;">
            ðŸ§¾ Go to Checkout (@OrderState.Order?.Pizzas?.Count item@((OrderState.Order?.Pizzas?.Count ?? 0) != 1 ? "s" : ""))
        </button>
    }
</div>

@code {
    List<PizzaSpecial>? specials;

    protected override async Task OnInitializedAsync()
    {
        specials = await Http.GetFromJsonAsync<List<PizzaSpecial>>("api/pizzas");
    }

    void AddSpecialToOrder(PizzaSpecial s)
    {
        var pizza = new Pizza { SpecialId = s.Id, Special = s, Size = 12 };
        OrderState.AddPizza(pizza);
        StateHasChanged();
    }
}
